<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>todos</title>

    <link rel="stylesheet" href="/css/default.css"/>
    <script type="text/javascript" src="webjars/jquery/2.1.4/jquery.min.js"></script>
</head>

<body>

<div class="content">

    <div class="todos-header">
        <h1 class="todos-title">todos</h1>
    </div>

    <div class="todos-container">
        <div class="todos-add">
            <button class="todos-add_select-all" aria-label="select all items as completed">
                <div class="todos-add_select-all_icon"></div>
            </button>
            <div class="todos-add_item-w">
                <input id="add_item" class="todos-add_item" placeholder="What needs to be done?" aria-label="add item">
            </div>
        </div>

        <div id="list" class="todos-list">
            <div class="todos-list_item">
                <div class="todos-list_item_checkbox todos-list_item_ready-mark">
                    <input type="checkbox" class="todos-list_item_checkbox_target"
                           aria-label="Mark as (un)completed item"/>
                    <div class="todos-list_item_checkbox_visual"></div>
                    <div class="todos-list_item_checkbox_no_visual"></div>
                </div>
                <button class="todos-list_item_edit" aria-label="edit item"></button>
                <button class="todos-list_item_remove" aria-label="remove item"></button>
                <div class="todos-list_item_name" contenteditable="false">HTML</div>
            </div>
            <div class="todos-list_item __complete">
                <div class="todos-list_item_checkbox todos-list_item_ready-mark">
                    <input type="checkbox" checked="checked" class="todos-list_item_checkbox_target"
                           aria-label="Mark as no completed item"/>
                    <div class="todos-list_item_checkbox_visual"></div>
                    <div class="todos-list_item_checkbox_no_visual"></div>
                </div>
                <button class="todos-list_item_edit" aria-label="edit item"></button>
                <button class="todos-list_item_remove" aria-label="remove item"></button>
                <div class="todos-list_item_name" contenteditable="false">CSS</div>
            </div>
            <div class="todos-list_item">
                <div class="todos-list_item_checkbox todos-list_item_ready-mark">
                    <input type="checkbox" class="todos-list_item_checkbox_target"
                           aria-label="Mark as completed item"/>
                    <div class="todos-list_item_checkbox_visual"></div>
                    <div class="todos-list_item_checkbox_no_visual"></div>
                </div>
                <button class="todos-list_item_edit" aria-label="edit item"></button>
                <button class="todos-list_item_remove" aria-label="remove item"></button>
                <div class="todos-list_item_name" contenteditable="false">JS</div>
            </div>
            <div class="todos-list_item">
                <div class="todos-list_item_checkbox todos-list_item_ready-mark">
                    <input type="checkbox" class="todos-list_item_checkbox_target"
                           aria-label="Mark as completed item"/>
                    <div class="todos-list_item_checkbox_visual"></div>
                    <div class="todos-list_item_checkbox_no_visual"></div>
                </div>
                <button class="todos-list_item_edit" aria-label="edit item"></button>
                <button class="todos-list_item_remove" aria-label="remove item"></button>
                <div class="todos-list_item_name" contenteditable="false">JS tools</div>
            </div>

        </div>

        <div class="todos-actions-bar">
            <div aria-label="Count of no completed items" class="todos-actions-bar_counter" contenteditable="false">
                3 items left
            </div>
            <div class="todos-actions-bar_filters">
                <!--align="center"-->
                <button class="todos-actions-bar_filter __active" data-filter="all"
                        aria-label="show all items">
                    All
                </button>
                <button class="todos-actions-bar_filter" data-filter="no_completed"
                        aria-label="show no completed items">
                    Active
                </button>
                <button class="todos-actions-bar_filter" data-filter="completed"
                        aria-label="show completed items">
                    Completed
                </button>
            </div>
            <div class="todos-actions-bar_clear" contenteditable="false">Clear completed</div>

        </div>

    </div>

</div>
<script>
    $(document).ready(function () {
        $(document).on('click', function (event) {
            let target = event.target;
            let parent = $(event.target).parent();
            let id = parent.attr('id');
            let name = parent.children(".todos-list_item_name").text();
            console.log(target.className);
            if (target.className === 'todos-list_item_remove') {
                let json = {"inputId": id};
                $.ajax(
                    {
                        url: '/subjects',
                        method: 'DELETE',
                        data: JSON.stringify(json),
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",
                        statusCode: {
                            200: function () {
                                parent.remove();
                            }
                        }
                    });
            }
            if (target.className === 'todos-list_item_edit') {
                let json = {"inputId": id, "inputName": name};
                $.ajax(
                    {
                        url: '/subjects',
                        method: 'POST',
                        data: JSON.stringify(json),
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",
                        statusCode: {
                            200: function (data) {
                                console.log(data)
                                // parent.remove();
                                // $(item_add).val('');
                            }
                        }
                    });
            }
        });


        const item_add = '#add_item';
        $(item_add).keydown(function (e) {
            if (e.keyCode == 13) {
                let value = $(item_add).val();
                let json = {"inputName": value};
                if (value.length > 0) {
                    $.ajax(
                        {
                            url: '/subjects',
                            method: 'PUT',
                            data: JSON.stringify(json),
                            dataType: 'json',
                            contentType: "application/json; charset=utf-8",
                            statusCode: {
                                200: function (data) {
                                    $("#list").append(
                                        '<div class="todos-list_item" id="' + data + '">\n' +
                                        '                <div class="todos-list_item_checkbox todos-list_item_ready-mark">\n' +
                                        '                    <input type="checkbox" class="todos-list_item_checkbox_target"\n' +
                                        '                           aria-label="Mark as (un)completed item"/>\n' +
                                        '                    <div class="todos-list_item_checkbox_visual"></div>\n' +
                                        '                    <div class="todos-list_item_checkbox_no_visual"></div>\n' +
                                        '                </div>\n' +
                                        '                <button class="todos-list_item_edit" aria-label="edit item"></button>\n' +
                                        '                <button class="todos-list_item_remove" aria-label="remove item"></button>\n' +
                                        '                <div class="todos-list_item_name" contenteditable="false">' + value + '</div>\n' +
                                        '            </div>'
                                    );
                                }
                            }
                        });
                    $(item_add).val('');
                }
            }
        });
        $.ajax({
            url:  '/',
            type: "GET",
            data: {some_key: some_val},
            success: function(response){
                $('#comments').append(response[0]); // сюда выводим первый элемент массива
                $('#list').text(response[1]); // сюда выводим соответственно 2-ой элемент
            },
            dataType: "json"
        });

    });
</script>
</body>
</html>