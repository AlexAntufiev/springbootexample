<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>todos</title>

    <link rel="stylesheet" href="/css/default.css"/>
    <script type="text/javascript" src="webjars/jquery/2.1.4/jquery.min.js"></script>
</head>

<body>

<div class="content">

    <div class="todos-header">
        <h1 class="todos-title">todos</h1>
    </div>

    <div class="todos-container">
        <div class="todos-add">
            <button class="todos-add_select-all" aria-label="select all items as completed">
                <div class="todos-add_select-all_icon"></div>
            </button>
            <div class="todos-add_item-w">
                <input id="add_item" class="todos-add_item" placeholder="What needs to be done?" aria-label="add item">
            </div>
        </div>

        <div id="list" class="todos-list">
        </div>

        <div class="todos-actions-bar">
            <div aria-label="Count of no completed items" class="todos-actions-bar_counter" contenteditable="false">
                3 items left
            </div>
            <div class="todos-actions-bar_filters">
                <!--align="center"-->
                <button class="todos-actions-bar_filter __active" data-filter="all"
                        aria-label="show all items">
                    All
                </button>
                <button class="todos-actions-bar_filter" data-filter="no_completed"
                        aria-label="show no completed items">
                    Active
                </button>
                <button class="todos-actions-bar_filter" data-filter="completed"
                        aria-label="show completed items">
                    Completed
                </button>
            </div>
            <div class="todos-actions-bar_clear" contenteditable="false">Clear completed</div>
        </div>

    </div>

</div>
<script>
    $(document).ready(function () {

        const item_add = '#add_item';
        $(item_add).keydown(function (e) {
            if (e.keyCode == 13) {
                let name = $(item_add).val();
                if (name.length > 0) {
                    let json = {"inputName": name};
                    console.log(name);
                    console.log(json);
                    $.ajax(
                        {
                            url: '/subjects',
                            method: 'PUT',
                            data: JSON.stringify(json),
                            dataType: 'json',
                            contentType: "application/json; charset=utf-8",
                            statusCode: {
                                200: function (data) {
                                    console.log(data);
                                    $("#list").append(
                                        '<div class="todos-list_item" id="' + data.id + '">\n' +
                                        '     <div class="todos-list_item_checkbox todos-list_item_ready-mark">\n' +
                                        '         <input type="checkbox" class="todos-list_item_checkbox_target"\n' +
                                        '                           aria-label="Mark as (un)completed item"/>\n' +
                                        '         <div class="todos-list_item_checkbox_visual"></div>\n' +
                                        '         <div class="todos-list_item_checkbox_no_visual"></div>\n' +
                                        '     </div>\n' +
                                        '     <button class="todos-list_item_edit" aria-label="edit item"></button>\n' +
                                        '     <button class="todos-list_item_remove" aria-label="remove item"></button>\n' +
                                        '     <input class="todos-list_item_name" readonly value="' + name + '"/>\n' +
                                        '</div>'
                                    );
                                    $(item_add).val('');
                                }
                            }
                        });
                }
            }
        });

        $(document).on('click', function (event) {
            let target = event.target;
            let parent = $(event.target).parent();
            let id = parent.attr('id');
            if (target.className === 'todos-list_item_remove') {
                let json = {"inputId": id};
                console.log(json);
                $.ajax(
                    {
                        url: '/subjects',
                        method: 'DELETE',
                        data: JSON.stringify(json),
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",
                        statusCode: {
                            200: function () {
                                parent.remove();
                            }
                        }
                    });
            }
            if (target.className === 'todos-list_item_edit') {
                let editItem = $(target).siblings('.todos-list_item_name');
                editItem.removeAttr('readonly');
                editItem.focus().val('').val(editItem.attr('value'));
                $(editItem).keydown(function (e) {
                    if (e.keyCode == 13) {
                        editItem.attr('readonly', '');
                        editItem.attr('value', editItem.val());
                        let json = {"inputId": id, "inputName": editItem.attr('value')};
                        console.log(json);
                        $.ajax(
                            {
                                url: '/subjects',
                                method: 'POST',
                                data: JSON.stringify(json),
                                dataType: 'json',
                                contentType: "application/json; charset=utf-8",
                                statusCode: {
                                    200: function (data) {
                                        console.log(data)
                                    }
                                }
                            });
                    }
                });
            }
        });

    });
</script>
</body>
</html>